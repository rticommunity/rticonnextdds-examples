<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="https://community.rti.com/schema/7.3.0/rti_dds_profiles.xsd" type="application/xml" schematypens="http://www.w3.org/2001/XMLSchema"?>
<dds>
    <types>
        <const name="VIN_LENGTH" type="uint8" value="17"/>
        <typedef name="VIN" type="string" stringMaxLength="VIN_LENGTH"/>

        <struct name="Coord" extensibility="final" nested="true">
            <member name="lat" type="float64"/>
            <member name="lon" type="float64"/>
        </struct>
        <struct name="VehicleTransit" extensibility="appendable">
            <member name="vehicle_vin"
                    type="nonBasic"
                    nonBasicTypeName="VIN"
                    key="true" />
            <member name="current_position"
                    type="nonBasic"
                    nonBasicTypeName="Coord" />
            <member name="current_route"
                    type="nonBasic"
                    nonBasicTypeName="Coord"
                    sequenceMaxLength="-1"
                    optional="true" /> <!-- 'no route' == standby -->
        </struct>

        <typedef name="Percentage" type="float64" min="0.0" max="100.0"/>
        <struct name="VehicleMetrics" extensibility="appendable">
            <member name="vehicle_vin"
                    type="nonBasic"
                    nonBasicTypeName="VIN"
                    key="true"/>
            <member name="fuel_level"
                    type="nonBasic"
                    nonBasicTypeName="Percentage"/>
        </struct>
    </types>

    <qos_library name="VehicleModeling_Library">
        <qos_profile name="VehicleMetrics_Profile">
            <datawriter_qos base_name="BuiltinQosLib::Generic.BestEffort">
                <deadline>
                    <period>
                        <sec>10</sec>
                        <nanosec>0</nanosec>
                    </period>
                </deadline>
            </datawriter_qos>
            <datareader_qos base_name="BuiltinQosLib::Generic.BestEffort">
                <deadline>
                    <period>
                        <sec>15</sec>
                        <nanosec>0</nanosec>
                    </period>
                </deadline>
            </datareader_qos>
        </qos_profile>
        <qos_profile name="VehicleTransit_Profile">
            <datawriter_qos base_name="BuiltinQosLib::Generic.StrictReliable">
                <durability>
                    <kind>TRANSIENT_LOCAL_DURABILITY_QOS</kind>
                </durability>
            </datawriter_qos>
            <datareader_qos base_name="BuiltinQosLib::Generic.KeepLastReliable">
                <durability>
                    <kind>TRANSIENT_LOCAL_DURABILITY_QOS</kind>
                </durability>
            </datareader_qos>
        </qos_profile>
    </qos_library>

    <domain_library name="DomainLibrary">
        <domain name="VehicleDomain" domain_id="0">
            <topic name="VehicleMetricsTopic" register_type_ref="VehicleMetrics" />
            <topic name="VehicleTransitTopic" register_type_ref="VehicleTransit" />
        </domain>
    </domain_library>

    <domain_participant_library name="ParticipantLibrary">
        <domain_participant name="PublisherApp" domain_ref="DomainLibrary::VehicleDomain">
            <data_writer name="MetricsWriter"
                         topic_ref="VehicleMetricsTopic">
                <datawriter_qos base_name="VehicleModeling_Library::VehicleMetrics_Profile" />
            </data_writer>

            <data_writer name="TransitWriter"
                        topic_ref="VehicleTransitTopic">
                <datawriter_qos base_name="VehicleModeling_Library::VehicleTransit_Profile" />
            </data_writer>
        </domain_participant>

        <domain_participant name="SubscriberApp" domain_ref="DomainLibrary::VehicleDomain">
            <data_reader name="MetricsReader"
                         topic_ref="VehicleMetricsTopic">
                <datareader_qos base_name="VehicleModeling_Library::VehicleMetrics_Profile" />
            </data_reader>
            <data_reader name="TransitReader"
                        topic_ref="VehicleTransitTopic">
                <datareader_qos base_name="VehicleModeling_Library::VehicleTransit_Profile" />
            </data_reader>
        </domain_participant>
    </domain_participant_library>
</dds>
